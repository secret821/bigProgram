<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0072)pay.html?selectedItemSpecIds=cake-1004-spec-1 -->
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0 ,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>结算页面</title>

    <link rel="shortcut icon" href="static/img/favicon.ico" type="image/x-icon"/>
    <link href="static/css/amazeui.css" rel="stylesheet" type="text/css">
    <link href="static/css/demo.css" rel="stylesheet" type="text/css">
    <link href="static/css/cartstyle.css" rel="stylesheet" type="text/css">
    <link href="static/css/jsstyle.css" rel="stylesheet" type="text/css">
    <link href="static/css/lee.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="static/js/jquery.min.js"></script>
    <script type="text/javascript" src="static/js/bootstrap.js"></script>
</head>

<body style="overflow: visible;">
<div id="container">
    <div class="concent" style="margin-top: 35px;">
        <div class="paycont">
            <div class="address">
                <h3>确认配送地址 </h3>
                <div class="control selected">
                    <div class="tc-btn createAddr theme-login am-btn am-btn-danger">新增地址</div>
                </div>
                <div class="clear"></div>
                <ul>
                    <template v-for="(addr,index) in addrs">
                        <li
                                style="margin-top: 6px;" :data-index="index">
                            <div class="address-left">
                                <div class="user">
												<span class="buy-address-detail">
													<span class="buy-user">{{addr.receiverName}}</span>
													<span class="buy-phone">{{addr.receiverMobile}}</span>
												</span>
                                </div>
                                <div class="default-address">
                                    <span class="buy-line-title buy-line-title-type">收货地址：</span>
                                    <span class="buy--address-detail">
													<span class="province">{{addr.province}}</span>
													<span class="city">{{addr.city}}</span>
													<span class="dist">{{addr.area}}</span>
													<span class="street">{{addr.addr}}</span>
                                                    <button class="btn btn-success btn-xs am-align-right"
                                                             v-if="addr.commonAddr==0" @click="setCommonAddr" :data-id="addr.addrId">设置为默认地址</button>
                                                    <button class="btn btn-success btn-xs am-align-right">编辑</button>
												</span>
                                </div>

                                <ins class="deftip" v-if="addr.commonAddr==1" >默认地址</ins>
                            </div>
                            <div class="address-right">
                                <a href="#"><span
                                        class="am-icon-angle-right am-icon-lg"></span></a>
                            </div>
                            <div class="clear"></div>

                        </li>
                    </template>
                </ul>
            </div>
        </div>
    </div>

</div>
<script type="text/javascript" src="static/js/utils.js"></script>
<script type="text/javascript" src="static/js/cookie_utils.js"></script>
<script type="text/javascript" src="static/js/vue.js"></script>
<script type="text/javascript" src="static/js/axios.min.js"></script>
<script type="text/javascript">
    var baseUrl = "http://localhost:8080/";
    var vm = new Vue({
        el: "#container",
        data: {
            addrs: [
                {
                    "addrId": "",
                    "userId": "",
                    "receiverName": "",
                    "receiverMobile": "",
                    "province": "",
                    "city": "",
                    "area": "",
                    "addr": "",
                    "postCode": "",
                    "status": 0,
                    "commonAddr": 0,
                    "createTime": "",
                    "updateTime": ""
                },
            ],
            addrIndex: 0,  //用户选择的地址的索引（默认值和当前用户地址的默认地址索引相同）
            userId: "",
            payType: 1,

        },
        created: function () {
            var token = getCookieValue("token");
            this.userId = getCookieValue("userId");
            axios({
                    url: baseUrl + "useraddr/list",
                    methods: "get",
                    headers: {
                        token: token
                    },
                    params: {
                        userId: this.userId
                    },
                }
            ).then(res => {
                if (res.data.code == 10009 || res.data.code == 10010) {
                    //跳转登录
                    window.location.href = encodeURI(login.html);
                } else if (res.data.code == 10000) {
                    this.addrs = res.data.data;
                }
            });

        },
        methods: {
            setCommonAddr:function (event){
                var addrId = event.srcElement.dataset.id;
                axios({
                        url: baseUrl + "useraddr/updataStatus",
                        methods: "get",
                        headers: {
                            token: getCookieValue("token"),
                        },
                        params: {
                            userId: this.userId,
                            addrId: addrId
                        },
                    }
                ).then(res=>{
                    if (res.data.code==99999){
                        alert("设置默认地址失败");
                        location.reload();
                    }else if(res.data.code==10000){
                        location.reload();
                    }
                })

            }
        }
    });

</script>

</body>

</html>